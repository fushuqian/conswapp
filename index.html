<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>手柄转换器配置</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>OGX-Mini 手柄转换器</h1>
            </div>
            <div id="subheader" class="subheader">
                <h3></h3>
            </div>
        </div>
        <div class="separator"></div>

        <div id="errorTxt" class="error hidden">
            ⚠️ 出现错误
            <br>
        </div>

        <div class="connectPanel show" id="connectPanel">
            <h3>设置</h3>
            <button class="connectButton" id="connectUsb">通过USB连接</button>
            <button class="connectButton" id="connectBt">通过蓝牙连接</button><br><br>
            <label><b>最低固件版本需求:</b> OGX-Mini v1.0.0-alpha3</label><br><br>
            <label><b>注意:</b> 长按手柄上的 START+LB+RB 3秒钟进入网页配置模式。</label>
            <div class="separator"></div>
            <h3>固件更新</h3>
            <button class="" id="connectOgxmW">无线手柄转换器</button>
        </div>

        <div class="programPanel hidden" id="programPanel">
            <label>
                <img src="images/OGXMW-Boot.jpg" alt="OGX-Mini Boot Button" width="300" height="300">
                <div class="separator"></div>
                <b>Step 1:</b> Hold down the <b>BOOT</b> button on your OGX-Mini Wireless while plugging it into your computer.<br>
                <b>Step 2:</b> Click <b>Update Part 1</b> and select the <b>RPI-RP2</b> drive from your file explorer.<br>
                <b>Step 3:</b> Click <b>Update Part 2</b> and select <b>OGX-Mini</b> from the dropdown menu.<br><br>
                <b>Note:</b> Do not remove your adapter while it is being updated. If the update fails, remove the adapter and plug it back in while holding the BOOT button, then reload this page to restart the process.<br>
            </label>
            <div class="separator"></div>
            <button id="button-programPico">Update Part 1</button>
            <button id="button-programEsp32">Update Part 2</button>

            <div class="programLogPanel">
                <textarea id="programLog" rows="16" cols="80" readonly></textarea>
            </div>
        </div>

        <div class="settingsPanel hidden" id="settingsPanel">
            <div class="triPanel">
                <div class="section">
                    <div class="header">
                        <h3>设备模式</h3>
                    </div>
                    <div class="dropDown">
                        <select id="dropdown-deviceMode"></select>
                    </div>
                </div>
                <div class="section">
                    <div class="header">
                        <h3>手柄</h3>
                    </div>
                    <div class="dropDown">
                        <select id="dropdown-playerIdx"></select>
                    </div>
                </div>
                <div class="section">
                    <h3>配置文件</h3>
                    <select id="dropdown-profileId"></select>
                </div>
            </div>

            <div class="togglePanelControl">
                <div class="header">
                    <h3>轴设置</h3>
                </div>
                <div class="buttonPanel">
                    <button id="button-toggleAxisSettings">隐藏</button>
                </div>
            </div>

            <div class="axisSettingsPanel" id="axisSettingsPanel">
                <div class="joystickPanel">
                    <div class="leftPanel">
                        <div class="headerButtonPair">
                            <div class="header">
                                <h4>左摇杆</h4>
                            </div>
                            <div class="button">
                                <label for="checkbox-previewJoy-left">预览</label>
                                <input type="checkbox" id="checkbox-previewJoy-left" class="invertCheckbox">
                            </div>
                        </div>
                        <div class="canvasContainer">
                            <canvas id="canvasJoystickBackground-left" width="260" height="260"></canvas>
                            <canvas id="canvasJoystickSettings-left" width="260" height="260"></canvas>
                            <canvas id="canvasJoystickCursor-left" width="260" height="260"></canvas>
                        </div>
                        <div class="joystickSettings">
                            <div id="joystickInput-left" class="joystickInput"></div>
                        </div>
                    </div>
                    <div class="rightPanel">
                        <div class="headerButtonPair">
                            <div class="header">
                                <h4>右摇杆</h4>
                            </div>
                            <div class="button">
                                <label for="checkbox-previewJoy-right">预览</label>
                                <input type="checkbox" id="checkbox-previewJoy-right" class="invertCheckbox">
                            </div>
                        </div>
                        <div class="canvasContainer">
                            <canvas id="canvasJoystickBackground-right" width="260" height="260"></canvas>
                            <canvas id="canvasJoystickSettings-right" width="260" height="260"></canvas>
                            <canvas id="canvasJoystickCursor-right" width="260" height="260"></canvas>
                        </div>
                        <div class="joystickSettings">
                            <div id="joystickInput-right" class="joystickInput"></div>
                        </div>
                    </div>
                </div>

                <div class="triggersPanel">
                    <div class="leftPanel">
                        <div class="headerButtonPair">
                            <div class="header">
                                <h4>左扳机</h4>
                            </div>
                            <div class="button">
                                <label for="checkbox-previewTrigger-left">预览</label>
                                <input type="checkbox" id="checkbox-previewTrigger-left" class="invertCheckbox">
                            </div>
                        </div>
                        <div class="canvasContainer">
                            <canvas id="canvasTriggerBackground-left" width="300" height="50"></canvas>
                            <canvas id="canvasTriggerSettings-left" width="300" height="50"></canvas>
                            <canvas id="canvasTriggerCursor-left" width="300" height="50"></canvas>
                        </div>
                        <div class="triggerSettings">
                            <div id="triggerInput-left" class="triggerInput"></div>
                        </div>
                    </div>
                    <div class="rightPanel">
                        <div class="headerButtonPair">
                            <div class="header">
                                <h4>右扳机</h4>
                            </div>
                            <div class="button">
                                <label for="checkbox-previewTrigger-right">预览</label>
                                <input type="checkbox" id="checkbox-previewTrigger-right" class="invertCheckbox">
                            </div>
                        </div>
                        <div class="canvasContainer">
                            <canvas id="canvasTriggerBackground-right" width="300" height="50"></canvas>
                            <canvas id="canvasTriggerSettings-right" width="300" height="50"></canvas>
                            <canvas id="canvasTriggerCursor-right" width="300" height="50"></canvas>
                        </div>
                        <div class="triggerSettings">
                            <div id="triggerInput-right" class="triggerInput"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="togglePanelControl">
                <div class="header">
                    <h3>数码映射</h3>
                </div>
                <div class="buttonPanel">
                    <button id="button-toggleDigitalButtons">隐藏</button>
                </div>
            </div>

            <div id="digitalButtonsPanel" class="digitalButtonsPanel">
                <h4>方向键</h4>
                <div class="dropdownGrid">
                    <div id="digitalDpadInput-left" class="digitalDpadInput"></div>
                    <div id="digitalDpadInput-right" class="digitalDpadInput"></div>
                </div>

                <h4>按键</h4>
                <div class="dropdownGrid">
                    <div id="digitalButtonInput-left" class="digitalButtonInput"></div>
                    <div id="digitalButtonInput-right" class="digitalButtonInput"></div>
                </div>
            </div>

            <div class="togglePanelControl">
                <div class="header">
                    <h3>模拟映射</h3>
                </div>
                <div class="buttonPanel">
                    <button id="button-toggleAnalogButtons">隐藏</button>
                </div>
            </div>

            <div id="analogButtonsPanel" class="analogButtonsPanel">
                <div class="analogEnabled">
                    <label for="checkbox-analogEnabled">启用模拟按键</label>
                    <input type="checkbox" id="checkbox-analogEnabled" class="invertCheckbox">
                </div> 
                <div class="dropdownGrid">
                    <div id="analogButtonsInput-left" class="analogButtonsInput"></div>
                    <div id="analogButtonsInput-right" class="analogButtonsInput"></div>
                </div>
            </div>

            <div class="controlsPanel">
                <button class="controlsButton" id="button-saveProfile">保存配置文件</button>
                <button class="controlsButton" id="button-reloadProfile">重新读取配置</button>
                <button class="controlsButton" id="button-loadDefaults">恢复默认</button>
                <button class="controlsButton" id="button-disconnect">断开连接</button>
            </div>
        </div>
    </div>
    <script type="module" src="index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
</body>
